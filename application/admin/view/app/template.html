{extend name='main'}

{block name="style"}
<link rel="stylesheet" href="__ROOT__/static/plugs/swiper/swiper.min.css?at={:date('md')}">

<style>
    .app-detail-right {
        float: left;
        width: 73%;
        margin: 0 33px 0 33px;
        min-height: 700px;
        border: 1px #000000 solid;
    }

    .duan-input {
        width: 53%;
        height: 30px;
        display: inline-block;
        margin-right: 33px;
        margin-left: 19px;
    }

    .app-detail .peizhi-title {
        width: 6%;
        display: inline-block;
        margin-top: 10px;
    }

    .app-upload {
        margin-left: 18px;
    }


    .swiper-container {
        width: 100%;
        height: 100%;
    }

    .swiper-slide {
        text-align: center;
        font-size: 18px;
        background: #fff;
        position: relative;
        padding: 5px;
        /* Center slide text vertically */

    }

    .fanhui {
        margin-left: 20px;
        margin-bottom: 10px;
        height: 29px;
        padding: 0 36px;
        line-height: 29px;
    }

    .zezao {
        width: 98%;
        height: 98%;
        position: absolute;
        z-index: 9;
        top: 0;
        left: 0;
        border: 2px #090 solid;
        display: none;
    }

    .ext_json_key {
        width: 120px;
        display: inline;
    }

    .ext_json_value {
        width: 300px;
        display: inline;
        margin: 0 20px;
    }

    .ext_json_line {
        margin-left: 0;
        margin-top: 10px;
    }

    .muban-save {
        text-align: center;
    }

</style>
{/block}
{block name="button"}

{if auth("add")}
<button data-modal='{:url("add")}' data-title="添加APP" class='layui-btn layui-btn-sm layui-btn-primary'>添加APP</button>
{/if}

{if auth("remove")}
<button data-action='{:url("remove")}' data-rule="id#{key}" data-csrf="{:systoken('remove')}"
        data-confirm="确定要删除这些APP吗？" class='layui-btn layui-btn-sm layui-btn-primary'>删除APP
</button>
{/if}

{/block}

{block name="content"}
<div class="think-box-shadow">
    <button type="button" class="layui-btn layui-btn-primary fanhui" onclick="history.go(-1)"><&nbsp;&nbsp;&nbsp;返回
    </button>

    <div class="app-detail">
        {include file="app/left" /}
        <div class="app-detail-right">
            <form class="layui-form layui-card" id="temForm" action="{:request()->url()}" data-auto="true" method="post"
                  autocomplete="off">
                <div class="layui-card-body padding-left-40">
                    <div class="layui-form-item">
                        <label class="relative block">
                            <span class="color-green font-w7 peizhi-title">模板ID</span>
                            <input name="template_id" id="template_id" value='{$row.template_id}'
                                   oninput="value=value.replace(/[^\d]/g,'')"
                                   class="layui-input duan-input"
                                   placeholder="输入模板ID进行搜索">
                        </label>
                    </div>

                    <div class="layui-form-item">
                        <label class="relative block">
                            <span class="color-green font-w7 peizhi-title">参数配置</span>

                            <div class="layui-hide ext_json_muban">
                                <div class="layui-input-block ext_json_line">
                                    <input type="text" name="ext_key[]" readonly placeholder="请输入KEY"
                                           value=""
                                           class="layui-input ext_json_key layui-bg-gray">
                                    <input type="text" name="ext_value[]" placeholder="请输入配置值"
                                           value=""
                                           class="layui-input ext_json_value">
                                </div>
                            </div>


                            {foreach $ext_json as $k=>$v}
                            <div class="layui-input-block ext_json_line">
                                <input type="text" name="ext_key[]" lay-verify="title" readonly placeholder="请输入KEY"
                                       value="{$k}"
                                       class="layui-input ext_json_key layui-bg-gray">
                                <input type="text" name="ext_value[]" lay-verify="title" placeholder="请输入VALUE"
                                       value="{$v}"
                                       class="layui-input ext_json_value">
                            </div>
                            {/foreach}
                        </label>
                    </div>

                    <input type='hidden' value='{$row.id}' name='id'>
                </div>


                <div class="layui-form-item muban-save">
                    <button class="layui-btn" type='submit'>保存数据</button>
                </div>
            </form>
        </div>
        <div class="clear"></div>
    </div>
</div>
<script>
    form.render();

    $(document).on('keyup', '#template_id', function (e) {

        $.ajax({
            type: "post",
            url: "{:url('getTemplateInfo')}",
            data: {classId: $(this).val(), appId: $('input[name="id"]').val()},
            success: function (rJson) {
                classTem = rJson.data;
                console.log(classTem);
            }
        });
    });


    layui.use(['upload'], function () {
        var upload = layui.upload;
        upload.render({
            elem: '.ext_img'
            , url: "{:url('api.plugs/upload')}"
            , exts: 'jpg|png|gif|bmp|jpeg'
            , accept: 'images'
            , acceptMime: "image/*"
            , progress: function (n) {
                var percent = n + '%' //获取进度百分比
            }
            , done: function (ret, index, upload) {
                this.multiple || $.msg.close(this.proindex);
                // console.log(ret);
                if (ret.uploaded) {
                    $(this.item).prev().val('/upload/' + ret.filename);
                    $(this.item).prev().prev().attr('src', ret.url);
                    $.msg.success('上传成功');
                } else {
                    $.msg.error(ret.info || ret.error.message || '文件上传出错！');
                }
            }
        });
    });


</script>


{/block}

{block name="script"}

{/block}